(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[933,8239,5036,6118,7344,8160,1034,8056,1906,4501,5312],{10933:(y,R,s)=>{s.r(R),s.d(R,{ACTIVE_COMMUNICATIONS_ATTRIBUTE_NAME:()=>j,CALL_INDICATOR_IMAGE:()=>z,CHATS_TAB_NAME:()=>Q,COMMUNICATIONS_PANEL_HAS_NEW_MESSAGES_ATTRIBUTE_NAME:()=>x,COMMUNICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>F,COMMUNICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>$,COMMUNICATION_PANEL_NAME:()=>U,COMMUNICATION_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>H,CONSULTATION_INDICATOR_IMAGE:()=>K,CONSULTATION_TAB_NAME:()=>Y,CTI_TAB_NAME:()=>w,CURRENT_CALL_CHANGED_ATTRIBUTE_NAME:()=>Z,CURRENT_CALL_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>W,CURRENT_COMMUNICATIONS_INFO_ATTRIBUTE_NAME:()=>V,CURRENT_CONSULTATION_CHANGED_ATTRIBUTE_NAME:()=>X,CURRENT_CONSULTATION_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>J,DISABLE_RIGHT_PANEL_PREPROCESSING_FEATURE_NAME:()=>q,LEGACY_SIDE_PANEL_ITEMS:()=>ne,LEGACY_SIDE_PANEL_NAME:()=>ie,LEGACY_SIDE_PANEL_SELECTED_ITEM:()=>ae,NOTIFICATIONS_PANEL_HAS_NEW_NOTIFICATIONS_ATTRIBUTE_NAME:()=>G,NOTIFICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>T,NOTIFICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>O,NOTIFICATIONS_PANEL_NAME:()=>S,NOTIFICATIONS_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>N,PREDEFINED_SIDEBARS:()=>re,RIGHT_PANEL_CONTACT_CHAT_ATTRIBUTE_NAME:()=>C,RIGHT_PANEL_CONTACT_CHAT_SUBSCRIPTION_ATTRIBUTE_NAME:()=>I,RIGHT_PANEL_LISTENER_SUBSCRIPTION_ATTRIBUTE_NAME:()=>h,RIGHT_PANEL_RESET_COUNTER_EVENT_NAME:()=>A,RIGHT_PANEL_RESET_COUNTER_LISTENER_ATTRIBUTE_NAME:()=>M,RIGHT_PANEL_SELECTED_TAB_ATTRIBUTE_NAME:()=>m,RIGHT_PANEL_SELECTED_TAB_SUBSCRIPTION_ATTRIBUTE_NAME:()=>p,RIGHT_PANEL_SET_SELECTED_TAB_EVENT_NAME:()=>P,SIDEBAR_EXTENSIONS_FEATURE_NAME:()=>ee,SIDEBAR_OPENED_STATE_ATTRIBUTE_NAME:()=>oe,SIDEBAR_OPENED_STATE_SUBSCRIPTION_ATTRIBUTE_NAME:()=>se,SIDE_PANEL_CONTAINER_NAME:()=>te,SidebarApiModule:()=>f,SidebarService:()=>l,SidebarStateService:()=>u,SidebarsConfigProvider:()=>b,findLeafSidebarInfo:()=>L,findNestedSidebarInGroup:()=>k,findRootSidebar:()=>D});const m="RightPanelSelectedTab",P="RightPanelSetSelectedTabEvent",p="RightPanelSelectedTabSubscription",h="RightPanelListenerSubscription",M="RightPanelResetCounterListener",A="RightPanelResetCounter",I="RightPanelContactChatSubscription",C="RightPanelContactChat",S="NotificationsPanel",N="NotificationsPanelItemsTabPanel_SelectedItem",T="NotificationsPanelItemsTabPanel_Items",O="NotificationsPanelModel",G="NotificationsPanelHasNewNotifications",U="CommunicationPanel",H="CommunicationsPanelItemsTabPanel_SelectedItem",$="CommunicationsPanelModel",F="CommunicationsPanelItemsTabPanel_Items",x="CommunicationsPanelHasNewMessages",V="CurrentCommunicationsInfo",j="ActiveCommunicationsInfo",w="CtiTab",W="CurrentCallChangedListener",Z="CurrentCallChanged",Y="OBSWTab",J="CurrentConsultationChangedListener",X="CurrentConsultationChanged",z="right-panel-call-timer",K="right-panel-consultation-timer",Q="ChatsTab",q="DisableRightPanelsPreprocessing",ee="SidebarExtensions",te="SidebarContainerWrapper",ie="LegacySidePanel",ne="LegacySidePanelItemsTabPanel_Items",ae="LegacySidePanelItemsTabPanel_SelectedItem",oe="SidebarOpenedState",se="SidebarOpenedState_Subscription",re=["FeedsTab","CtiTab","EmailsTab","ChatsTab","OBSWTab","ReminderTab","EsnNotificationsTab","VisaNotificationsTab","AnniversaryNotificationsTab","SystemNotificationsTab","BusinessProcessTab"];var B=s(31134),v=s(33177);const de=JSON.parse('{"Sidebar":{"PredefinedSidebars":{"FeedsTabCaption":"Feed","ReminderTabCaption":"Reminders","EsnNotificationsTabCaption":"Feed notifications","VisaNotificationsTabCaption":"Approvals","AnniversaryNotificationsTabCaption":"Noteworthy events","SystemNotificationsTabCaption":"System messages","BusinessProcessTabCaption":"Business process tasks"},"PredefinedSidebarGroups":{"CommunicationPanel":"Communication panel","NotificationsPanel":"Notifications panel"}}}'),_e=JSON.parse('{"Sidebar":{"PredefinedSidebars":{"FeedsTabCaption":"\u041B\u0435\u043D\u0442\u0430","ReminderTabCaption":"\u041D\u0430\u043F\u043E\u043C\u0438\u043D\u0430\u043D\u0438\u044F","EsnNotificationsTabCaption":"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u043B\u0435\u043D\u0442\u044B","VisaNotificationsTabCaption":"\u0412\u0438\u0437\u044B","AnniversaryNotificationsTabCaption":"\u0417\u043D\u0430\u043C\u0435\u043D\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0441\u043E\u0431\u044B\u0442\u0438\u044F","SystemNotificationsTabCaption":"\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F","BusinessProcessTabCaption":"\u0417\u0430\u0434\u0430\u0447\u0438 \u043F\u043E \u0431\u0438\u0437\u043D\u0435\u0441-\u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0430\u043C"},"PredefinedSidebarGroups":{"CommunicationPanel":"\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u043E\u043D\u043D\u0430\u044F \u043F\u0430\u043D\u0435\u043B\u044C","NotificationsPanel":"\u041F\u0430\u043D\u0435\u043B\u044C \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439"}}}'),ce={"en-US":de,"ru-RU":_e};var d=s(94450);class f{}f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=d.\u0275\u0275defineNgModule({type:f}),f.\u0275inj=d.\u0275\u0275defineInjector({imports:[B.CommonModule,v.CrtLibTranslateModule.forRoot({i18n:ce})]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&d.\u0275\u0275setNgModuleScope(f,{imports:[B.CommonModule,v.CrtLibTranslateModule]})}();var Se=s(77207),r=s(21322),Te=s(2876);class l{constructor(e){this._httpClient=e,this.serviceEndpoint="/ServiceModel/SidebarService.svc/",this.getItemsMethodName="GetItems"}getItems(){const e=`${this.serviceEndpoint}${this.getItemsMethodName}`;return this._httpClient.post(e,null)}}l.\u0275fac=function(e){return new(e||l)(d.\u0275\u0275inject(Te.HttpClient))},l.\u0275prov=d.\u0275\u0275defineInjectable({token:l,factory:l.\u0275fac,providedIn:"root"});class b{constructor(e,t){this._sidebarService=e,this._translateService=t,this._additionalProperties={CtiTab:{containerClasses:["ts-cti-container"]},ChatsTab:{containerId:"OmniChatModule_WrapContainer"}},this._communicationPanelDefinitions=[{code:"FeedsTab",title:this._translateInstant("PredefinedSidebars.FeedsTabCaption"),icon:"right-panel-feeds",schemaName:"CommunicationsPanel_FeedsTab",containerClasses:["ts-feed-container"],index:1e3,autoHideNotificationMark:!1}],this._notificationsPanelDefinitions=[{code:"ReminderTab",title:this._translateInstant("PredefinedSidebars.ReminderTabCaption"),icon:"right-panel-reminding-notifications",schemaName:"NotificationsPanel_ReminderTab",index:1e3,autoHideNotificationMark:!1},{code:"EsnNotificationsTab",title:this._translateInstant("PredefinedSidebars.EsnNotificationsTabCaption"),icon:"right-panel-esn-notifications",schemaName:"NotificationsPanel_EsnNotificationsTab",index:2e3,autoHideNotificationMark:!1},{code:"VisaNotificationsTab",title:this._translateInstant("PredefinedSidebars.VisaNotificationsTabCaption"),icon:"right-panel-visa-notifications",schemaName:"NotificationsPanel_VisaNotificationsTab",index:3e3,autoHideNotificationMark:!1},{code:"AnniversaryNotificationsTab",title:this._translateInstant("PredefinedSidebars.AnniversaryNotificationsTabCaption"),icon:"right-panel-anniversary-notifications",schemaName:"NotificationsPanel_AnniversaryNotificationsTab",index:4e3,autoHideNotificationMark:!1},{code:"SystemNotificationsTab",title:this._translateInstant("PredefinedSidebars.SystemNotificationsTabCaption"),icon:"right-panel-system-notifications",schemaName:"NotificationsPanel_SystemNotificationsTab",index:5e3,autoHideNotificationMark:!1},{code:"BusinessProcessTab",title:this._translateInstant("PredefinedSidebars.BusinessProcessTabCaption"),icon:"right-panel-business-processes",schemaName:"NotificationsPanel_BusinessProcessTab",index:6e3,autoHideNotificationMark:!1}]}_translateInstant(e){return this._translateService.instant(`Sidebar.${e}`)}_createLeafSidebarDefinitionBase(e){return{code:e.code,title:e.title,icon:e.icon,schemaName:e.schemaName,index:e.index,autoHideNotificationMark:e.autoHideNotificationMark}}_createNestedSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),...this._additionalProperties[e.code]}}_createStandaloneSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),type:"standalone"}}_sortSidebarsByIndexAndCode(e,t){return e.index-t.index||e.code.localeCompare(t.code)}_fillCustomSidebarToSidebarGroupDefinition(e,t){const n=e.filter(i=>i.groupCode===t.code).map(i=>this._createNestedSidebarDefinition(i));return t.nestedSidebars=[...t.nestedSidebars,...n].sort((i,a)=>this._sortSidebarsByIndexAndCode(i,a)),t}_mapResponseItemsToDefinitions(e){const t=e.filter(n=>n.groupCode===null).map(n=>this._createStandaloneSidebarDefinition(n));return[this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:U,outerContainerClasses:["communication-panel-item-container"],nestedSidebarsContainerClasses:["communications-panel-items-tab-panel"],nestedSidebars:this._communicationPanelDefinitions,title:this._translateInstant("PredefinedSidebarGroups.CommunicationPanel"),icon:"tools-icon",index:9e3}),this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:S,outerContainerClasses:["ts-notifications-container","communication-panel-item-container"],nestedSidebarsContainerClasses:["notifications-panel-items-tab-panel"],nestedSidebars:this._notificationsPanelDefinitions,title:this._translateInstant("PredefinedSidebarGroups.NotificationsPanel"),icon:"notifications-icon",index:1e4}),...t]}getSidebarsConfig(){return this._cachedSidebarsConfig$=this._cachedSidebarsConfig$??this._sidebarService.getItems().pipe((0,r.catchError)(()=>(0,r.of)({success:!1,items:[]})),(0,r.map)(e=>({rootSidebars:this._mapResponseItemsToDefinitions(e.items).sort((i,a)=>this._sortSidebarsByIndexAndCode(i,a))})),(0,r.shareReplay)({bufferSize:1,refCount:!1})),this._cachedSidebarsConfig$}}b.\u0275fac=function(e){return new(e||b)(d.\u0275\u0275inject(l),d.\u0275\u0275inject(Se.TranslateService))},b.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"});var _=s(8239);function D(o,e){return e.rootSidebars.find(t=>t.code===o)}function k(o,e){return e.nestedSidebars.find(t=>t.code===o)}function L(o,e){const t=e.rootSidebars.find(i=>i.code===o&&i.type!=="group");if(t)return{leafSidebar:t,group:null};const n=e.rootSidebars.filter(i=>i.type==="group").flatMap(i=>i.nestedSidebars.map(a=>({group:i,nestedSidebar:a}))).find(i=>i.nestedSidebar.code===o);return n?{leafSidebar:n.nestedSidebar,group:n.group}:void 0}class u{constructor(e){this._sidebarsConfigProvider=e,this._notificationMarks={rootSidebars$:new r.BehaviorSubject({}),nestedSidebars$:new r.BehaviorSubject({}),nestedSidebarsSnapshot:{}},this._opened={rootSidebar$:new r.BehaviorSubject(null),nestedSidebars$:new r.BehaviorSubject({}),leafSidebar$:new r.BehaviorSubject(null),snapshot$:new r.BehaviorSubject({leafSidebar:null,nestedSidebars:{}})},this.notificationMarks={rootSidebars$:this._notificationMarks.rootSidebars$.asObservable(),nestedSidebars$:this._notificationMarks.nestedSidebars$.asObservable()},this.opened={rootSidebar$:this._opened.rootSidebar$.asObservable(),nestedSidebars$:this._opened.nestedSidebars$.asObservable(),leafSidebar$:this._opened.leafSidebar$.asObservable(),snapshot$:this._opened.snapshot$.asObservable()}}_getSidebarsConfig(){return(0,r.firstValueFrom)(this._sidebarsConfigProvider.getSidebarsConfig())}_updateNestedNotificationMarksSnapshot(e,t,n){const i=e.code,a=t.code;let c=this._notificationMarks.nestedSidebarsSnapshot[a];c||(c={},this._notificationMarks.nestedSidebarsSnapshot[a]=c),c[i]=n}_shouldSkipNotificationMark(e,t){const{markState:n,leafSidebarInfo:i}=e;return i.leafSidebar.code===t&&i.leafSidebar.autoHideNotificationMark&&n.visible}_autoHideNotificationMark(e){var t=this;return(0,_.Z)(function*(){!e.autoHideNotificationMark||(yield t.setLeafNotificationMarks({[e.code]:{visible:!1}}))})()}_isNotificationMarkStateChanged(e,t){return(e?.visible??!1)!==t.visible}_emitNestedSidebarsNotificationMarks(e){const t=this._notificationMarks.nestedSidebars$.getValue();let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;this._updateNestedNotificationMarksSnapshot(a,i.leafSidebarInfo.group,i.markState),n||(n=this._isNotificationMarkStateChanged(t[a.code],i.markState)),t[a.code]=i.markState}!n||this._notificationMarks.nestedSidebars$.next(t)}_setSidebarGroupsNotificationMarks(e){let t=!1;for(const[n,i]of Object.entries(this._notificationMarks.nestedSidebarsSnapshot)){const c={visible:Object.values(i).some(g=>g.visible)};t||(t=this._isNotificationMarkStateChanged(e[n],c)),e[n]=c}return t}_setStandaloneSidebarsNotificationMarks(e,t){let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;n||(n=this._isNotificationMarkStateChanged(t[a.code],i.markState)),t[a.code]=i.markState}return n}_emitRootSidebarsNotificationMarks(e){const t=this._notificationMarks.rootSidebars$.getValue(),n=this._setSidebarGroupsNotificationMarks(t),i=this._setStandaloneSidebarsNotificationMarks(e,t);!(n||i)||this._notificationMarks.rootSidebars$.next(t)}_emitIfChanged(e,t){return e.getValue()===t?!1:(e.next(t),!0)}_getLeafSidebarOpenedState(e){return e.nestedSidebar??e.rootSidebar}_emitOpenedSidebar(e){this._emitIfChanged(this._opened.rootSidebar$,e.rootSidebar);const t=this._getLeafSidebarOpenedState(e);if(this._opened.leafSidebar$.next(t),e.nestedSidebar){const n=this._opened.nestedSidebars$.getValue(),i=e.rootSidebar;n[i]!==e.nestedSidebar&&this._opened.nestedSidebars$.next({...n,[i]:e.nestedSidebar})}this._opened.snapshot$.next({leafSidebar:t,nestedSidebars:this._opened.nestedSidebars$.getValue()})}_openSidebarInGroup(e,t){var n=this;return(0,_.Z)(function*(){n._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:t.code}),yield n._autoHideNotificationMark(t)})()}_openSidebarGroup(e){var t=this;return(0,_.Z)(function*(){const n=e.code,i=t._opened.nestedSidebars$.getValue()[n];let a;if(i&&(a=k(i,e),a||console.warn(`It is not possible to open nested sidebar with code "${i}" because it does not belong to the specified group with code "${n}"`)),a||(a=e.nestedSidebars[0]),!a){console.warn(`It is not possible to open sidebar group with code "${n}" because it does not contain any nested sidebars`);return}yield t._openSidebarInGroup(e,a)})()}_openStandaloneSidebar(e){var t=this;return(0,_.Z)(function*(){t._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:null}),yield t._autoHideNotificationMark(e)})()}_openLeafSidebarInternal(e){var t=this;return(0,_.Z)(function*(){if(t._opened.leafSidebar$.getValue()===e)return!1;const n=yield t._getSidebarsConfig(),i=L(e,n);return i?(i.group?yield t._openSidebarInGroup(i.group,i.leafSidebar):yield t._openStandaloneSidebar(i.leafSidebar),!0):(console.warn(`Leaf sidebar with code "${e}" does not exist and can not be opened`),!1)})()}setLeafNotificationMarks(e){var t=this;return(0,_.Z)(function*(){const n=yield t._getSidebarsConfig(),i=t._opened.leafSidebar$.getValue(),a=Object.entries(e).map(([E,Ee])=>({markState:Ee,leafSidebarInfo:L(E,n)})).filter(E=>E.leafSidebarInfo&&!t._shouldSkipNotificationMark(E,i)),c=a.filter(E=>E.leafSidebarInfo.group!==null),g=a.filter(E=>E.leafSidebarInfo.group===null);t._emitNestedSidebarsNotificationMarks(c),t._emitRootSidebarsNotificationMarks(g)})()}openLeafSidebar(e){var t=this;return(0,_.Z)(function*(){yield t._openLeafSidebarInternal(e)})()}openRootSidebar(e){var t=this;return(0,_.Z)(function*(){if(t._opened.rootSidebar$.getValue()===e)return;const n=yield t._getSidebarsConfig(),i=D(e,n);if(!i){console.warn(`Root sidebar with code "${e}" does not exist and can not be opened`);return}i.type==="group"?yield t._openSidebarGroup(i):yield t._openStandaloneSidebar(i)})()}loadOpenedSidebarSnapshot(e){var t=this;return(0,_.Z)(function*(){t._opened.nestedSidebars$.next(e.nestedSidebars);const n=e.leafSidebar;n&&(yield t._openLeafSidebarInternal(n))||t._opened.snapshot$.next(e)})()}closeSidebar(){this._emitOpenedSidebar({rootSidebar:null,nestedSidebar:null})}}u.\u0275fac=function(e){return new(e||u)(d.\u0275\u0275inject(b))},u.\u0275prov=d.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac,providedIn:"root"})},8239:(y,R,s)=>{s.d(R,{Z:()=>P});function m(p,h,M,A,I,C,S){try{var N=p[C](S),T=N.value}catch(O){M(O);return}N.done?h(T):Promise.resolve(T).then(A,I)}function P(p){return function(){var h=this,M=arguments;return new Promise(function(A,I){var C=p.apply(h,M);function S(T){m(C,A,I,S,N,"next",T)}function N(T){m(C,A,I,S,N,"throw",T)}S(void 0)})}}}}]);
