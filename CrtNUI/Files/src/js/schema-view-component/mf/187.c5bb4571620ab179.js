(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[187],{61345:(Ee,A,d)=>{d.r(A),d.d(A,{ACTIVE_COMMUNICATIONS_ATTRIBUTE_NAME:()=>j,CALL_INDICATOR_IMAGE:()=>X,CHATS_TAB_NAME:()=>K,COMMUNICATIONS_PANEL_HAS_NEW_MESSAGES_ATTRIBUTE_NAME:()=>F,COMMUNICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>$,COMMUNICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>H,COMMUNICATION_PANEL_NAME:()=>C,COMMUNICATION_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>y,CONSULTATION_INDICATOR_IMAGE:()=>z,CONSULTATION_TAB_NAME:()=>Z,CTI_TAB_NAME:()=>V,CURRENT_CALL_CHANGED_ATTRIBUTE_NAME:()=>W,CURRENT_CALL_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>w,CURRENT_COMMUNICATIONS_INFO_ATTRIBUTE_NAME:()=>x,CURRENT_CONSULTATION_CHANGED_ATTRIBUTE_NAME:()=>J,CURRENT_CONSULTATION_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>Y,DISABLE_RIGHT_PANEL_PREPROCESSING_FEATURE_NAME:()=>Q,LEGACY_SIDE_PANEL_ITEMS:()=>ie,LEGACY_SIDE_PANEL_NAME:()=>te,LEGACY_SIDE_PANEL_SELECTED_ITEM:()=>ne,NOTIFICATIONS_PANEL_HAS_NEW_NOTIFICATIONS_ATTRIBUTE_NAME:()=>G,NOTIFICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>D,NOTIFICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>k,NOTIFICATIONS_PANEL_NAME:()=>I,NOTIFICATIONS_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>v,PREDEFINED_SIDEBARS:()=>se,RIGHT_PANEL_CONTACT_CHAT_ATTRIBUTE_NAME:()=>B,RIGHT_PANEL_CONTACT_CHAT_SUBSCRIPTION_ATTRIBUTE_NAME:()=>U,RIGHT_PANEL_LISTENER_SUBSCRIPTION_ATTRIBUTE_NAME:()=>O,RIGHT_PANEL_RESET_COUNTER_EVENT_NAME:()=>g,RIGHT_PANEL_RESET_COUNTER_LISTENER_ATTRIBUTE_NAME:()=>L,RIGHT_PANEL_SELECTED_TAB_ATTRIBUTE_NAME:()=>R,RIGHT_PANEL_SELECTED_TAB_SUBSCRIPTION_ATTRIBUTE_NAME:()=>P,RIGHT_PANEL_SET_SELECTED_TAB_EVENT_NAME:()=>m,SIDEBAR_EXTENSIONS_FEATURE_NAME:()=>q,SIDEBAR_OPENED_STATE_ATTRIBUTE_NAME:()=>ae,SIDEBAR_OPENED_STATE_SUBSCRIPTION_ATTRIBUTE_NAME:()=>oe,SIDE_PANEL_CONTAINER_NAME:()=>ee,SidebarApiModule:()=>T,SidebarService:()=>E,SidebarStateService:()=>f,SidebarsConfigProvider:()=>N,findLeafSidebarInfo:()=>l,findNestedSidebarInGroup:()=>h,findRootSidebar:()=>M});const R="RightPanelSelectedTab",m="RightPanelSetSelectedTabEvent",P="RightPanelSelectedTabSubscription",O="RightPanelListenerSubscription",L="RightPanelResetCounterListener",g="RightPanelResetCounter",U="RightPanelContactChatSubscription",B="RightPanelContactChat",I="NotificationsPanel",v="NotificationsPanelItemsTabPanel_SelectedItem",D="NotificationsPanelItemsTabPanel_Items",k="NotificationsPanelModel",G="NotificationsPanelHasNewNotifications",C="CommunicationPanel",y="CommunicationsPanelItemsTabPanel_SelectedItem",H="CommunicationsPanelModel",$="CommunicationsPanelItemsTabPanel_Items",F="CommunicationsPanelHasNewMessages",x="CurrentCommunicationsInfo",j="ActiveCommunicationsInfo",V="CtiTab",w="CurrentCallChangedListener",W="CurrentCallChanged",Z="OBSWTab",Y="CurrentConsultationChangedListener",J="CurrentConsultationChanged",X="right-panel-call-timer",z="right-panel-consultation-timer",K="ChatsTab",Q="DisableRightPanelsPreprocessing",q="SidebarExtensions",ee="SidebarContainerWrapper",te="LegacySidePanel",ie="LegacySidePanelItemsTabPanel_Items",ne="LegacySidePanelItemsTabPanel_SelectedItem",ae="SidebarOpenedState",oe="SidebarOpenedState_Subscription",se=["FeedsTab","CtiTab","EmailsTab","ChatsTab","OBSWTab","ReminderTab","EsnNotificationsTab","VisaNotificationsTab","AnniversaryNotificationsTab","SystemNotificationsTab","BusinessProcessTab"];var u=d(31134),p=d(33177);const re=JSON.parse('{"Sidebar":{"PredefinedSidebars":{"FeedsTabCaption":"Feed","ReminderTabCaption":"Reminders","EsnNotificationsTabCaption":"Feed notifications","VisaNotificationsTabCaption":"Approvals","AnniversaryNotificationsTabCaption":"Noteworthy events","SystemNotificationsTabCaption":"System messages","BusinessProcessTabCaption":"Business process tasks"},"PredefinedSidebarGroups":{"CommunicationPanel":"Communication panel","NotificationsPanel":"Notifications panel"}}}'),de=JSON.parse('{"Sidebar":{"PredefinedSidebars":{"FeedsTabCaption":"\u041B\u0435\u043D\u0442\u0430","ReminderTabCaption":"\u041D\u0430\u043F\u043E\u043C\u0438\u043D\u0430\u043D\u0438\u044F","EsnNotificationsTabCaption":"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u043B\u0435\u043D\u0442\u044B","VisaNotificationsTabCaption":"\u0412\u0438\u0437\u044B","AnniversaryNotificationsTabCaption":"\u0417\u043D\u0430\u043C\u0435\u043D\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0441\u043E\u0431\u044B\u0442\u0438\u044F","SystemNotificationsTabCaption":"\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F","BusinessProcessTabCaption":"\u0417\u0430\u0434\u0430\u0447\u0438 \u043F\u043E \u0431\u0438\u0437\u043D\u0435\u0441-\u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0430\u043C"},"PredefinedSidebarGroups":{"CommunicationPanel":"\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u043E\u043D\u043D\u0430\u044F \u043F\u0430\u043D\u0435\u043B\u044C","NotificationsPanel":"\u041F\u0430\u043D\u0435\u043B\u044C \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439"}}}'),_e={"en-US":re,"ru-RU":de};var r=d(94450);class T{}T.\u0275fac=function(e){return new(e||T)},T.\u0275mod=r.\u0275\u0275defineNgModule({type:T}),T.\u0275inj=r.\u0275\u0275defineInjector({imports:[u.CommonModule,p.CrtLibTranslateModule.forRoot({i18n:_e})]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(T,{imports:[u.CommonModule,p.CrtLibTranslateModule]})}();var ce=d(77207),s=d(21322),Se=d(2876);class E{constructor(e){this._httpClient=e,this.serviceEndpoint="/ServiceModel/SidebarService.svc/",this.getItemsMethodName="GetItems"}getItems(){const e=`${this.serviceEndpoint}${this.getItemsMethodName}`;return this._httpClient.post(e,null)}}E.\u0275fac=function(e){return new(e||E)(r.\u0275\u0275inject(Se.HttpClient))},E.\u0275prov=r.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"});class N{constructor(e,t){this._sidebarService=e,this._translateService=t,this._additionalProperties={CtiTab:{containerClasses:["ts-cti-container"]},ChatsTab:{containerId:"OmniChatModule_WrapContainer"}},this._communicationPanelDefinitions=[{code:"FeedsTab",title:this._translateInstant("PredefinedSidebars.FeedsTabCaption"),icon:"right-panel-feeds",schemaName:"CommunicationsPanel_FeedsTab",containerClasses:["ts-feed-container"],index:1e3,autoHideNotificationMark:!1}],this._notificationsPanelDefinitions=[{code:"ReminderTab",title:this._translateInstant("PredefinedSidebars.ReminderTabCaption"),icon:"right-panel-reminding-notifications",schemaName:"NotificationsPanel_ReminderTab",index:1e3,autoHideNotificationMark:!1},{code:"EsnNotificationsTab",title:this._translateInstant("PredefinedSidebars.EsnNotificationsTabCaption"),icon:"right-panel-esn-notifications",schemaName:"NotificationsPanel_EsnNotificationsTab",index:2e3,autoHideNotificationMark:!1},{code:"VisaNotificationsTab",title:this._translateInstant("PredefinedSidebars.VisaNotificationsTabCaption"),icon:"right-panel-visa-notifications",schemaName:"NotificationsPanel_VisaNotificationsTab",index:3e3,autoHideNotificationMark:!1},{code:"AnniversaryNotificationsTab",title:this._translateInstant("PredefinedSidebars.AnniversaryNotificationsTabCaption"),icon:"right-panel-anniversary-notifications",schemaName:"NotificationsPanel_AnniversaryNotificationsTab",index:4e3,autoHideNotificationMark:!1},{code:"SystemNotificationsTab",title:this._translateInstant("PredefinedSidebars.SystemNotificationsTabCaption"),icon:"right-panel-system-notifications",schemaName:"NotificationsPanel_SystemNotificationsTab",index:5e3,autoHideNotificationMark:!1},{code:"BusinessProcessTab",title:this._translateInstant("PredefinedSidebars.BusinessProcessTabCaption"),icon:"right-panel-business-processes",schemaName:"NotificationsPanel_BusinessProcessTab",index:6e3,autoHideNotificationMark:!1}]}_translateInstant(e){return this._translateService.instant(`Sidebar.${e}`)}_createLeafSidebarDefinitionBase(e){return{code:e.code,title:e.title,icon:e.icon,schemaName:e.schemaName,index:e.index,autoHideNotificationMark:e.autoHideNotificationMark}}_createNestedSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),...this._additionalProperties[e.code]}}_createStandaloneSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),type:"standalone"}}_sortSidebarsByIndexAndCode(e,t){return e.index-t.index||e.code.localeCompare(t.code)}_fillCustomSidebarToSidebarGroupDefinition(e,t){const n=e.filter(i=>i.groupCode===t.code).map(i=>this._createNestedSidebarDefinition(i));return t.nestedSidebars=[...t.nestedSidebars,...n].sort((i,a)=>this._sortSidebarsByIndexAndCode(i,a)),t}_mapResponseItemsToDefinitions(e){const t=e.filter(n=>n.groupCode===null).map(n=>this._createStandaloneSidebarDefinition(n));return[this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:C,outerContainerClasses:["communication-panel-item-container"],nestedSidebarsContainerClasses:["communications-panel-items-tab-panel"],nestedSidebars:this._communicationPanelDefinitions,title:this._translateInstant("PredefinedSidebarGroups.CommunicationPanel"),icon:"tools-icon",index:9e3}),this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:I,outerContainerClasses:["ts-notifications-container","communication-panel-item-container"],nestedSidebarsContainerClasses:["notifications-panel-items-tab-panel"],nestedSidebars:this._notificationsPanelDefinitions,title:this._translateInstant("PredefinedSidebarGroups.NotificationsPanel"),icon:"notifications-icon",index:1e4}),...t]}getSidebarsConfig(){return this._cachedSidebarsConfig$=this._cachedSidebarsConfig$??this._sidebarService.getItems().pipe((0,s.catchError)(()=>(0,s.of)({success:!1,items:[]})),(0,s.map)(e=>({rootSidebars:this._mapResponseItemsToDefinitions(e.items).sort((i,a)=>this._sortSidebarsByIndexAndCode(i,a))})),(0,s.shareReplay)({bufferSize:1,refCount:!1})),this._cachedSidebarsConfig$}}N.\u0275fac=function(e){return new(e||N)(r.\u0275\u0275inject(E),r.\u0275\u0275inject(ce.TranslateService))},N.\u0275prov=r.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac,providedIn:"root"});var _=d(8239);function M(o,e){return e.rootSidebars.find(t=>t.code===o)}function h(o,e){return e.nestedSidebars.find(t=>t.code===o)}function l(o,e){const t=e.rootSidebars.find(i=>i.code===o&&i.type!=="group");if(t)return{leafSidebar:t,group:null};const n=e.rootSidebars.filter(i=>i.type==="group").flatMap(i=>i.nestedSidebars.map(a=>({group:i,nestedSidebar:a}))).find(i=>i.nestedSidebar.code===o);return n?{leafSidebar:n.nestedSidebar,group:n.group}:void 0}class f{constructor(e){this._sidebarsConfigProvider=e,this._notificationMarks={rootSidebars$:new s.BehaviorSubject({}),nestedSidebars$:new s.BehaviorSubject({}),nestedSidebarsSnapshot:{}},this._opened={rootSidebar$:new s.BehaviorSubject(null),nestedSidebars$:new s.BehaviorSubject({}),leafSidebar$:new s.BehaviorSubject(null),snapshot$:new s.BehaviorSubject({leafSidebar:null,nestedSidebars:{}})},this.notificationMarks={rootSidebars$:this._notificationMarks.rootSidebars$.asObservable(),nestedSidebars$:this._notificationMarks.nestedSidebars$.asObservable()},this.opened={rootSidebar$:this._opened.rootSidebar$.asObservable(),nestedSidebars$:this._opened.nestedSidebars$.asObservable(),leafSidebar$:this._opened.leafSidebar$.asObservable(),snapshot$:this._opened.snapshot$.asObservable()}}_getSidebarsConfig(){return(0,s.firstValueFrom)(this._sidebarsConfigProvider.getSidebarsConfig())}_updateNestedNotificationMarksSnapshot(e,t,n){const i=e.code,a=t.code;let c=this._notificationMarks.nestedSidebarsSnapshot[a];c||(c={},this._notificationMarks.nestedSidebarsSnapshot[a]=c),c[i]=n}_shouldSkipNotificationMark(e,t){const{markState:n,leafSidebarInfo:i}=e;return i.leafSidebar.code===t&&i.leafSidebar.autoHideNotificationMark&&n.visible}_autoHideNotificationMark(e){var t=this;return(0,_.Z)(function*(){!e.autoHideNotificationMark||(yield t.setLeafNotificationMarks({[e.code]:{visible:!1}}))})()}_isNotificationMarkStateChanged(e,t){return(e?.visible??!1)!==t.visible}_emitNestedSidebarsNotificationMarks(e){const t=this._notificationMarks.nestedSidebars$.getValue();let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;this._updateNestedNotificationMarksSnapshot(a,i.leafSidebarInfo.group,i.markState),n||(n=this._isNotificationMarkStateChanged(t[a.code],i.markState)),t[a.code]=i.markState}!n||this._notificationMarks.nestedSidebars$.next(t)}_setSidebarGroupsNotificationMarks(e){let t=!1;for(const[n,i]of Object.entries(this._notificationMarks.nestedSidebarsSnapshot)){const c={visible:Object.values(i).some(b=>b.visible)};t||(t=this._isNotificationMarkStateChanged(e[n],c)),e[n]=c}return t}_setStandaloneSidebarsNotificationMarks(e,t){let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;n||(n=this._isNotificationMarkStateChanged(t[a.code],i.markState)),t[a.code]=i.markState}return n}_emitRootSidebarsNotificationMarks(e){const t=this._notificationMarks.rootSidebars$.getValue(),n=this._setSidebarGroupsNotificationMarks(t),i=this._setStandaloneSidebarsNotificationMarks(e,t);!(n||i)||this._notificationMarks.rootSidebars$.next(t)}_emitIfChanged(e,t){return e.getValue()===t?!1:(e.next(t),!0)}_getLeafSidebarOpenedState(e){return e.nestedSidebar??e.rootSidebar}_emitOpenedSidebar(e){this._emitIfChanged(this._opened.rootSidebar$,e.rootSidebar);const t=this._getLeafSidebarOpenedState(e);if(this._opened.leafSidebar$.next(t),e.nestedSidebar){const n=this._opened.nestedSidebars$.getValue(),i=e.rootSidebar;n[i]!==e.nestedSidebar&&this._opened.nestedSidebars$.next({...n,[i]:e.nestedSidebar})}this._opened.snapshot$.next({leafSidebar:t,nestedSidebars:this._opened.nestedSidebars$.getValue()})}_openSidebarInGroup(e,t){var n=this;return(0,_.Z)(function*(){n._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:t.code}),yield n._autoHideNotificationMark(t)})()}_openSidebarGroup(e){var t=this;return(0,_.Z)(function*(){const n=e.code,i=t._opened.nestedSidebars$.getValue()[n];let a;if(i&&(a=h(i,e),a||console.warn(`It is not possible to open nested sidebar with code "${i}" because it does not belong to the specified group with code "${n}"`)),a||(a=e.nestedSidebars[0]),!a){console.warn(`It is not possible to open sidebar group with code "${n}" because it does not contain any nested sidebars`);return}yield t._openSidebarInGroup(e,a)})()}_openStandaloneSidebar(e){var t=this;return(0,_.Z)(function*(){t._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:null}),yield t._autoHideNotificationMark(e)})()}_openLeafSidebarInternal(e){var t=this;return(0,_.Z)(function*(){if(t._opened.leafSidebar$.getValue()===e)return!1;const n=yield t._getSidebarsConfig(),i=l(e,n);return i?(i.group?yield t._openSidebarInGroup(i.group,i.leafSidebar):yield t._openStandaloneSidebar(i.leafSidebar),!0):(console.warn(`Leaf sidebar with code "${e}" does not exist and can not be opened`),!1)})()}setLeafNotificationMarks(e){var t=this;return(0,_.Z)(function*(){const n=yield t._getSidebarsConfig(),i=t._opened.leafSidebar$.getValue(),a=Object.entries(e).map(([S,Te])=>({markState:Te,leafSidebarInfo:l(S,n)})).filter(S=>S.leafSidebarInfo&&!t._shouldSkipNotificationMark(S,i)),c=a.filter(S=>S.leafSidebarInfo.group!==null),b=a.filter(S=>S.leafSidebarInfo.group===null);t._emitNestedSidebarsNotificationMarks(c),t._emitRootSidebarsNotificationMarks(b)})()}openLeafSidebar(e){var t=this;return(0,_.Z)(function*(){yield t._openLeafSidebarInternal(e)})()}openRootSidebar(e){var t=this;return(0,_.Z)(function*(){if(t._opened.rootSidebar$.getValue()===e)return;const n=yield t._getSidebarsConfig(),i=M(e,n);if(!i){console.warn(`Root sidebar with code "${e}" does not exist and can not be opened`);return}i.type==="group"?yield t._openSidebarGroup(i):yield t._openStandaloneSidebar(i)})()}loadOpenedSidebarSnapshot(e){var t=this;return(0,_.Z)(function*(){t._opened.nestedSidebars$.next(e.nestedSidebars);const n=e.leafSidebar;n&&(yield t._openLeafSidebarInternal(n))||t._opened.snapshot$.next(e)})()}closeSidebar(){this._emitOpenedSidebar({rootSidebar:null,nestedSidebar:null})}}f.\u0275fac=function(e){return new(e||f)(r.\u0275\u0275inject(N))},f.\u0275prov=r.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"root"})}}]);
