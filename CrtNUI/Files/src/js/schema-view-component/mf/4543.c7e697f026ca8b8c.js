(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[4543],{3272:(B,N,r)=>{r.d(N,{A:()=>O});var v=r(94450),l=r.n(v);const O=new v.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},15915:(B,N,r)=>{r.d(N,{B:()=>D});var v=r(33177),l=r.n(v),O=r(49475),L=r.n(O),y=r(34617),M=r.n(y),m=r(97600),E=r.n(m),j=r(3272),d=r(32935),p=r(94450),I=r.n(p);class D{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(s,o,i){var n;this._window=s,this._featureValues=i,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,o!==null&&(this._historyLimit=o),((n=this._window).__crtHistory??(n.__crtHistory=[])).push(this)}_assertIndexedState(s){if(!("historyIndex"in s)||isNaN(s.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let s=this._current+1;s<this._items.length;s++)this.destroy(s);for(let s=0;s<this._current-this._historyLimit;s++)this.destroy(s)}destroy(s){const o=this._items[s];o?.view&&(o.view.destroy(),o.view=null)}_hasChildrenState(s){const o=s.state;return!(0,m.isEmpty)(o.children)}_getRootViewForChildrenRouting(){let s=!0;const o=this._items[this._current].state;for(let i=this._current-1;i>=0;i--){const n=this._items[i];if((0,m.isEmpty)(n)||!s)return null;if((0,y.crtStatesEqual)(o,n.state)&&s&&!(0,m.isEmpty)(n?.view?.pageRef))return n.view;s=this._hasChildrenState(n)}return null}goTo(s){this._assertIndexedState(s),this._previous=this._current,this._current=s.historyIndex;const o=this._current<this._previous,i=o&&!this._items[this._current],n=this._current===this._previous,u=this._current>this._previous;this._lastTransition={isBack:o,isReplace:n,isPush:u},!(s.silent&&!s._internalNotSilentIn8x&&!o)&&(n&&this.destroy(this._previous),(i||n||u)&&(this._items[this._current]={state:s}),u&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const o=this._getCurrentView()?.pageRef;return this._current<this._previous&&Boolean(o)}_getCurrentView(){const s=this._items[this._current],o=this._hasChildrenState(s);let i;return o&&(0,m.isEmpty)(s?.view?.pageRef)&&(i=this._getRootViewForChildrenRouting()),i?new d.f7(i.pageRef,s?.view?.modalRefs,i.schemaState,i.pageRefReusable,i.scrollPositions,this._featureValues):s?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(s){return this._items[this._current+s]?.view}validateBeforeStore(s){const o=this._items[this._current].view;if(o?.pageRef&&o?.pageRef!==s.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(s){this.validateBeforeStore(s),this._items[this._current].view=s}}D.\u0275fac=function(s){return new(s||D)(p.\u0275\u0275inject(v.WINDOW_TOKEN),p.\u0275\u0275inject(j.A,8),p.\u0275\u0275inject(O.FEATURE_VALUES))},D.\u0275prov=p.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})},85431:(B,N,r)=>{r.d(N,{vq:()=>U,ex:()=>T});var v=r(27049);const l=1;class O{constructor(c,S){this._bindingContext=c,this._dataGridViewConfig=S}getViewModelItemsAttributeName(){const c=this._dataGridViewConfig.items;if(c&&typeof c=="string")return c.substring(l)}getViewModel(){return this._bindingContext.viewModel$.pipe((0,v.take)(1))}getDataSourceName(){return this.getViewModel().pipe((0,v.map)(c=>c.getBoundDataSourceName(this.getViewModelItemsAttributeName())))}}var L=r(41307),y=r(34038);const M="DisableCompiledCellView",m="EnableDataGridColumnEdit";function E(V){return V.getFeatureState(M).pipe((0,v.distinctUntilChanged)(),(0,v.map)(c=>!c))}const j={provide:y.USE_DATA_TABLE_COMPILED_CELLS_VIEW,useFactory:E,deps:[L.FeatureService]};var d=r(94450),p=r(14537);class I{resolve(c){return new O(c.get(p.BINDING_CONTEXT),c.get(p.VIEW_ELEMENT_CONFIG))}}I.\u0275fac=function(c){return new(c||I)},I.\u0275prov=d.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"});var D=r(46338),C=r(21322);class s{constructor(c,S){this._featureService=c,this._rightsService=S}getFeatures(){return(0,C.forkJoin)([this._featureService.getFeatureState(D.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE),this._featureService.getFeatureState(m),this._rightsService.getCanExecuteOperation(D.CAN_CREATE_DEFAULT_GRID_SETTING_OPERATION_CODE)]).pipe((0,v.map)(([c,S,R])=>({rows:{toolbar:!0,numeration:!0,selection:{enable:!1,multiple:!1}},columns:{toolbar:!0,sorting:!0,resizing:!0,dragAndDrop:!0,editing:S,adding:!0},cells:{selection:!0},header:{visible:!0},operations:{canCreateDefaultGridSettings:R},editable:!c})))}}s.\u0275fac=function(c){return new(c||s)(d.\u0275\u0275inject(L.FeatureService),d.\u0275\u0275inject(L.RightsService))},s.\u0275prov=d.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"});let o={};const i={provide:y.DATA_GRID_FEATURES,useFactory:()=>o};class n{constructor(c){this._dataGridFeaturesService=c}init(){return this._dataGridFeaturesService.getFeatures().pipe((0,v.tap)(c=>o=c),(0,v.map)(()=>{}))}}n.\u0275fac=function(c){return new(c||n)(d.\u0275\u0275inject(s))},n.\u0275prov=d.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"});var u=r(8239),h=r(49475),g=r(52045),F=r(24709),x=r(97600);class T extends D.BaseDataGridStateHandlerService{constructor(c,S,R,A,P,_,e,t){super(c),this._schemaPartsService=S,this._metadataModifierService=R,this._featureValues=A,this._dataGridDesignSettingsProvider=P,this._dataGridDesignSettingsUpdater=_,this._dataGridActiveFolderDesignSettingsProvider=e,this._dataGridMetadataTransferService=t}_getActiveFolderDataGridDesignSettings(c){return this.viewModel$.pipe((0,v.switchMap)(S=>this._dataGridActiveFolderDesignSettingsProvider.get({viewConfig:c,viewModel:S,metadata:this.schemaService.schema})))}_saveSettingsForFolder(c,S){const{columns:R,viewElementConfig:A}=S,P=(0,x.cloneDeep)(R),_=c.columns?.map(t=>t?.viewMetadata);this._metadataModifierService.revert(P),this._setColumnsCaptionResourceMacros(P,_);const e=this._dataGridDesignSettingsUpdater.updateColumns(c,P,A);return this.viewModel$.pipe((0,v.switchMap)(t=>this._dataGridActiveFolderDesignSettingsProvider.set({viewConfig:A,viewModel:t,metadata:this.schemaService.schema},e)),(0,v.switchMap)(()=>this._schemaPartsService.commit({silent:!1})),(0,v.map)(()=>{}))}_setColumnsCaptionResourceMacros(c,S){(c??[]).filter(R=>R&&!(0,h.isResourceMacros)(R.caption)).forEach(R=>{const A=this._getColumnCaptionResourceKey(R,S);R.caption=(0,h.toResourceMacros)(A)})}_getColumnCaptionResourceKey(c,S){const R=S?.find(_=>_?.id&&_.id===c.id),A=(0,h.extractResourcesKey)(R?.caption),P=(0,y.createDataGridColumnCaptionResourceKey)(c);return A||P}_saveSettingsToProfile(c){var S=this;const{columns:R,viewElementConfig:A}=c,P=(0,x.cloneDeep)(R);let _=P?.some(e=>e.changed);return(0,C.from)(this._schemaPartsService.apply(function(){var e=(0,u.Z)(function*([t,a]){const f=t.getViewConfigInfoByName(A?.name)?.viewConfig;if(!f)return;const w=yield S._dataGridDesignSettingsProvider.get(f,t,a),W=w.columns?.map(H=>H?.viewMetadata).filter(Boolean);S._metadataModifierService.revert(P),S._setColumnsCaptionResourceMacros(P,W),_=_||P?.length!==W?.length;const k=S._dataGridDesignSettingsUpdater.updateColumns(w,P,f);f._designOptions?.designSettings||(yield S._revertDeprecatedMetadata(f.name,k,t,a)),(0,x.set)(f,"_designOptions.designSettings",k)});return function(t){return e.apply(this,arguments)}}())).pipe((0,v.switchMap)(()=>this._schemaPartsService.commit({silent:_===!1})),(0,v.map)(()=>{}))}_revertDeprecatedMetadata(c,S,R,A){var P=this;return(0,u.Z)(function*(){const[_]=yield P._schemaPartsService.use("ALL_EMPLOYERS");yield P._dataGridMetadataTransferService.transfer(_,R,c);const e={localizableStrings:{}};Object.keys(S.resources?.localizableStrings).forEach(t=>e.localizableStrings[t]=void 0),yield A.upsertResources(e)})()}innerHandle(c){return this._featureValues.DisableDataGridSettingsByFolders?this._saveSettingsToProfile(c):this._getActiveFolderDataGridDesignSettings(c.viewElementConfig).pipe((0,v.switchMap)(S=>S?this._saveSettingsForFolder(S,c):this._saveSettingsToProfile(c)))}handle(c,S){return super.handle({...c},S)}}T.\u0275fac=function(c){return new(c||T)(d.\u0275\u0275inject(g.SchemaService),d.\u0275\u0275inject(g.SchemaPartsService),d.\u0275\u0275inject(F.MetadataModifierService),d.\u0275\u0275inject(h.FEATURE_VALUES),d.\u0275\u0275inject(y.DataGridDesignSettingsProvider),d.\u0275\u0275inject(y.DataGridDesignSettingsUpdater),d.\u0275\u0275inject(y.DataGridActiveFolderDesignSettingsProvider),d.\u0275\u0275inject(y.DataGridMetadataTransferService))},T.\u0275prov=d.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac});var G=r(74742),b=r(75378);function K(V){return()=>(0,C.lastValueFrom)(V.init(),{defaultValue:null})}let U=class{};U.\u0275fac=function(c){return new(c||U)},U.\u0275mod=d.\u0275\u0275defineNgModule({type:U}),U.\u0275inj=d.\u0275\u0275defineInjector({providers:[i,j,{provide:d.APP_INITIALIZER,useFactory:K,deps:[n],multi:!0}],imports:[D.CrtDataGridCdkModule,y.CrtDataGridToolbarModule]}),U=(0,G.__decorate)([(0,b.CrtModule)({includes:[D.CrtDataGridCdkModule]})],U),function(){(typeof ngJitMode>"u"||ngJitMode)&&d.\u0275\u0275setNgModuleScope(U,{imports:[D.CrtDataGridCdkModule],exports:[y.CrtDataGridToolbarModule]})}()},32935:(B,N,r)=>{r.d(N,{aK:()=>l,Hi:()=>v,HO:()=>j,TV:()=>m,pb:()=>M,dh:()=>E,Vr:()=>D,f7:()=>L});class v{constructor(s){s&&(this.title=s.title,this.schemaName=s.schemaName)}}class l{}var O=r(21322);class L{constructor(s=null,o=new Map,i=s?.instance?.schemaState,n=!1,u=s?.instance?.scrollPositions,h={}){this.pageRef=s,this.modalRefs=o,this.schemaState=i,this.pageRefReusable=n,this.scrollPositions=u,this._featureValues=h,this.isDestroyed=!1}_destroyModalViews(){const s=this?.modalRefs;s?.size&&(Array.from(s.values()).forEach(o=>o.close()),this.modalRefs.clear())}_destroyViewModelAsync(s){return this._featureValues.DisableHandleFixedViewModelResumePauseRequest?s?.destroy().pipe((0,O.take)(1)):(0,O.concat)(s?.pause()??(0,O.of)(),s?.destroy()??(0,O.of)()).pipe((0,O.take)(2))}destroy(){if(this._destroyModalViews(),this.pageRefReusable)this.pageRef?.instance?.schemaComponent?.clearResources(this.schemaState.viewModel),this._destroyViewModelAsync(this.schemaState.viewModel).subscribe(),this.schemaState.viewModel=null,this.schemaState.models=null,this.schemaState=null;else{const s=this.pageRef?.instance?.schemaComponent?.schemaState;this._destroyViewModelAsync(s?.viewModel).subscribe(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null}this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}var y=r(94450),M;(function(C){C.LookupValues="lookupValues",C.Filter="filter"})(M||(M={}));const m=M.LookupValues;var E;(function(C){C[C.Legacy=0]="Legacy",C[C.New=1]="New"})(E||(E={}));const j=new y.InjectionToken("PageLookupDataToken");var d=r(8239),p=r(75378),I=r(97600);class D{get canceled(){return this._canceled}get filter(){return this._filter}constructor(s){this._cachedLookupValues=[],this._entityName=s?.entityName,this._selectionState=s?.selectionState,this._filter=s?.filter,this._cachedLookupValues=s?.cachedLookupValues??[],this._canceled=s?.canceled??!1}_getFilterByPrimaryValues(s,o){const i=new p.EntitySchemaQuery("tempTable"),n=new p.ColumnExpression({columnPath:s}),u=o.map(F=>new p.ParameterExpression({value:F})),h=new p.InFilter(p.ComparisonType.Equal,n,u);return i.filters.add(h),i.getMetadata().filters}_loadLookupValues(s,o,i,n){return(0,d.Z)(function*(){const{primaryAttributeName:u,primaryDisplayAttributeName:h,primaryColorAttributeName:g}=o,F=[u,h,g].filter(Boolean);return(yield s.load({attributes:F,parameters:[{type:p.ModelParameterType.Filter,value:i}],options:n?{pagingConfig:n}:{}})).map(T=>({value:T[u],displayValue:T[h],primaryColorValue:T[g]}))})()}_loadLookupValuesByPrimaryValues(s,o){var i=this;return(0,d.Z)(function*(){if(!o.length)return[];const n=yield p.Model.create(s),u=yield n.getSchema(),h=i._getFilterByPrimaryValues(u.primaryAttributeName,o);return i._loadLookupValues(n,u,h)})()}_isCached(s){return this._cachedLookupValues.some(o=>o.value===s)}getLookupValues(s){var o=this;return(0,d.Z)(function*(){if(!o._selectionState||o.canceled)return[];const i=s?.pagingConfig;if(o._selectionState?.type==="specific"){let n;(0,I.isUndefined)(i?.rowsOffset)||(0,I.isUndefined)(i?.rowCount)?n=[...o._selectionState.selected]:n=o._selectionState.selected.slice(i?.rowsOffset,i?.rowsOffset+i?.rowCount);const u=n.filter(g=>!o._isCached(g)),h=yield o._loadLookupValuesByPrimaryValues(o._entityName,u);return n.map(g=>o._cachedLookupValues.find(F=>F.value===g)||h.find(F=>F.value===g))}else{const n=yield p.Model.create(o._entityName),u=yield n.getSchema();return o._loadLookupValues(n,u,o._filter,i)}})()}}},67483:(B,N,r)=>{r.d(N,{jZ:()=>b,SX:()=>j,j_:()=>n,Tx:()=>R,b:()=>x,zi:()=>i,jW:()=>h,mJ:()=>u,dO:()=>T,am:()=>K.a,Gm:()=>E,F$:()=>U.F,Lu:()=>U.L,Q1:()=>F,bn:()=>P,N1:()=>d,FL:()=>D,Wn:()=>S});var v=r(2876),l=r(94450),O=r(75378),L=r(77207),y=r(49475),M=r(97600),m=r(21322),E;(function(_){_[_.AddRelatedRecords=0]="AddRelatedRecords",_[_.RemoveRelatedRecords=1]="RemoveRelatedRecords"})(E||(E={}));class j{constructor(){this._translateService=(0,l.inject)(L.TranslateService),this._httpClient=(0,l.inject)(v.HttpClient),this._userInfo=(0,l.inject)(y.UserInfo)}get _relatedInMainRecordsServiceEndpoint(){return(this._userInfo.isSSP?"ssp/":"")+`rest/${this.relatedInMainRecordsServiceName}/`}_isInvalidParameters(e){return(0,M.isEmpty)(e.relatedRecordsSchemaName)||(0,M.isEmpty)(e.relatedInMainRecordsSchemaName)||(0,M.isEmpty)(e.relatedRecordColumnName)||(0,M.isEmpty)(e.mainRecordColumnName)||!this._isValidFilters(e.relatedRecordsFilters)||!this._isValidFilters(e.mainRecordsFilters)}_isValidFilters(e){return(0,M.isObject)(e)&&"items"in e&&!(0,M.isEmpty)(e.items)}_catchHttpErrorResponse(e){return(0,m.of)({success:!1,message:e.error?.errorInfo?.message??e.message})}_createEsqWithFilters(e,t){const a=new O.EntitySchemaQuery(e);return this._addFiltersToEsq(a,t),a}_addFiltersToEsq(e,t){Object.entries(t.items).forEach(([a,f])=>{e.filters.add(f,a)})}getServiceResultMessage(e,t,a){if(e.success){const f=this.relatedRecordsActionsNames.get(t);return this._translateService.instant(`${this.relatedInMainRecordsServiceName}.ServiceResult.${f}${a}`,{count:(0,M.get)(e,"processedRecordsCount",null)})}return e.errorInfo?.message||this._translateService.instant("BaseRelatedInMainRecordsService.ServiceResult.ErrorMessage")}executeAction(e,t){return this._isInvalidParameters(t)?(0,m.of)({success:!1,message:this._translateService.instant("BaseRelatedInMainRecordsService.NotValidParametersMessage")}):this.process(e,t)}process(e,t){const a=this.createRelatedRecordsEsq(t),f=this.createMainRecordsEsq(t),w=this.createRequest(a,f,t);return this.callService(e,w,t)}createRelatedRecordsEsq(e){return this._createEsqWithFilters(e.relatedRecordsSchemaName,e.relatedRecordsFilters)}createMainRecordsEsq(e){return this._createEsqWithFilters(e.mainRecordsSchemaName,e.mainRecordsFilters)}callService(e,t,a){const f=this.relatedRecordsActionsNames.get(e);return this._httpClient.post(`${this._relatedInMainRecordsServiceEndpoint}${f}`,{request:t}).pipe((0,m.map)(w=>({success:w.success,message:this.getServiceResultMessage(w,e,"Message")})),(0,m.catchError)(w=>this._catchHttpErrorResponse(w)))}addRelatedRecords(e){return this.executeAction(E.AddRelatedRecords,e)}removeRelatedRecords(e){return this.executeAction(E.RemoveRelatedRecords,e)}}class d extends j{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[E.AddRelatedRecords,"AddRecords"],[E.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,folderColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}}d.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(d)))(t||d)}}(),d.\u0275prov=l.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac});var p=r(41307),I=r(6523);class D extends j{constructor(){super(...arguments),this._featureValues=(0,l.inject)(y.FEATURE_VALUES),this._processEngineService=(0,l.inject)(p.ProcessEngineService),this._queryExecutor=(0,l.inject)(I.QueryExecutor),this._disableAsyncTaggingFeatureName="DisableAsyncTagging",this._taggingProcessName="TaggingProcess",this._syncRequestMaxRecordsCount=200,this.relatedInMainRecordsServiceName="TaggingService",this.relatedRecordsActionsNames=new Map([[E.AddRelatedRecords,"AddTags"],[E.RemoveRelatedRecords,"RemoveTags"]])}_isDisabledAsyncTagging(){return!!this._featureValues[this._disableAsyncTaggingFeatureName]}_callProcess(e,t){const a=this._createProcessParameters(e,t);return this._processEngineService.executeProcessByName(this._taggingProcessName,a).pipe((0,m.map)(f=>({success:f.success,message:super.getServiceResultMessage(f,e,"SuccessfulRunProcess")})))}_createProcessParameters(e,t){return{TaggingAction:this.relatedRecordsActionsNames.get(e),RecordsEsqSerialized:t.recordsEsqSerialized,TagsEsqSerialized:t.tagsEsqSerialized,TagInRecordSchemaName:t.tagInRecordSchemaName,RecordColumnName:t.recordColumnName,TagColumnName:t.tagColumnName,DefaultValues:t.defaultValues}}_getRecordsCount(e){const t=this.createRelatedRecordsEsq(e);this._addRowCountToEsq(t);const a=this.createMainRecordsEsq(e);return this._addRowCountToEsq(a),(0,m.forkJoin)([this._getEsqRecordsCount(t),this._getEsqRecordsCount(a)]).pipe((0,m.map)(([f,w])=>f*w))}_addRowCountToEsq(e){e.rowCount=this._syncRequestMaxRecordsCount+1}_getEsqRecordsCount(e){return this._queryExecutor.executeSelectQuery(e).pipe((0,m.map)(t=>t.length))}_isNeedCallService(e){return this._isDisabledAsyncTagging()?(0,m.of)(!0):this._getRecordsCount(e).pipe((0,m.map)(t=>t<=this._syncRequestMaxRecordsCount))}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),tagsEsqSerialized:JSON.stringify(t.getMetadata()),tagInRecordSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,tagColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}callService(e,t,a){return this._isNeedCallService(a).pipe((0,m.switchMap)(f=>f?super.callService(e,t,a):this._callProcess(e,t)))}}D.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(D)))(t||D)}}(),D.\u0275prov=l.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac});var C=r(8239),s=r(27049),o=r(32935);const i="Desktop",n="CrtCurrentDesktop";class u{constructor(e,t,a,f){this._queryExecutor=e,this._sysSettingsService=t,this._rightsService=a,this._userProfileService=f,this._canEditDesktopOperationName="CanManageSolution",this._currentDesktopSchemaNameInitialized=!1,this._canEditDesktopSchemaInitialized=!1,this._canEditDesktopSchema=!1}_convertToDesktops(e,t){const a=t.get("schemaName"),f=t.get("title");return e.map(w=>new o.Hi({schemaName:w[a],title:w[f]}))}_requestDesktopSysSetting(){return(0,m.lastValueFrom)(this._sysSettingsService.getValueByCode(n,""))}_requestDesktopProfileSettings(){return(0,m.lastValueFrom)(this._userProfileService.getProfile(n))}getCurrentDesktopSchemaName(){var e=this;return(0,C.Z)(function*(){if(!e._currentDesktopSchemaNameInitialized){let t=yield e._requestDesktopProfileSettings();(0,M.isEmpty)(t)&&(t=yield e._requestDesktopSysSetting()),e._currentDesktopSchemaName=t,e._currentDesktopSchemaNameInitialized=!0}return e._currentDesktopSchemaName})()}getUserDesktops(){const e=new Map([["schemaName","DesktopSchemaName"],["title","Title"]]),t=new O.EntitySchemaQuery(i);return t.addSchemaColumn(e.get("schemaName")),t.addSchemaColumn(e.get("title")),(0,m.firstValueFrom)(this._queryExecutor.executeSelectQuery(t).pipe((0,m.map)(a=>this._convertToDesktops(a,e))))}setCurrentDesktop(e){var t=this;return(0,C.Z)(function*(){const a=e?e.schemaName:null;t._currentDesktopSchemaName=a,yield(0,m.firstValueFrom)(t._userProfileService.saveProfile(n,a))})()}canEditDesktop(){return this._canEditDesktopSchemaInitialized?Promise.resolve(this._canEditDesktopSchema):(0,m.lastValueFrom)(this._rightsService.getCanExecuteOperation(this._canEditDesktopOperationName).pipe((0,s.tap)(e=>{this._canEditDesktopSchema=e,this._canEditDesktopSchemaInitialized=!0})))}}u.\u0275fac=function(e){return new(e||u)(l.\u0275\u0275inject(I.QueryExecutor),l.\u0275\u0275inject(p.SysSettingsService),l.\u0275\u0275inject(p.RightsService),l.\u0275\u0275inject(p.UserProfileService))},u.\u0275prov=l.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac,providedIn:"root"});class h{constructor(){this._repository=new Map}set(e,t){this._repository.set(e,t)}get(e){return this._repository.get(e)}getAll(){return Array.from(this._repository.values())}}h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=l.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac,providedIn:"root"});var g=r(24709);class F extends g.DataSourceFactoryService{constructor(e,t,a){super(t,a),this._dataSourceRepository=e}create(e,t,a){return super.create(e,t,a).pipe((0,s.tap)(f=>{this._dataSourceRepository.set(e,f)}))}}F.\u0275fac=function(e){return new(e||F)(l.\u0275\u0275inject(h),l.\u0275\u0275inject(l.Injector),l.\u0275\u0275inject(g.DataSourceTypeResolver))},F.\u0275prov=l.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac});class x{constructor(e){this._configurationDataService=e}getConfigurationStructure(){return this._configurationDataService.getData(!0).pipe((0,m.map)(e=>{if(!e.success)throw new Error(e.errorInfo.message);return e.data}))}}x.\u0275fac=function(e){return new(e||x)(l.\u0275\u0275inject(p.ConfigurationDataService))},x.\u0275prov=l.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"any"});class T extends y.BaseFileUploadProcessingService{constructor(e,t){super(e,t)}createFileErrorMessageForLogs(e){return super.createFileErrorMessageForLogs(e)}processSelectedFiles(e,t){var a=()=>super.processSelectedFiles,f=this;return(0,C.Z)(function*(){return a().call(f,e,t)})()}}T.\u0275fac=function(e){return new(e||T)(l.\u0275\u0275inject(L.TranslateService),l.\u0275\u0275inject(O.SysSettingsService))},T.\u0275prov=l.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"});var G=r(34617);class b{getDefaultAppearanceSettings(e){return(0,m.from)(G.NavigationUtils.isMiniPage(e)).pipe((0,m.map)(t=>({modalSettings:{size:t?y.ModalSize.Small:y.ModalSize.ExtraLarge}})))}}var K=r(39630),U=r(76596),V=r(33177),c=r(15915);class S extends g.ViewModelDataDelayer{constructor(e,t,a,f){super(),this._crtRouter=e,this._routerOutletHistory=t,this._featureValues=a,this._window=f,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new m.Subscription,this._loadTriggerSubject=new m.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,M.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(e){this._viewModel||(this._viewModel=e)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(e,t){return e&&e.modalRefs?Array.from(e.modalRefs.values()).some(a=>a?.componentInstance?.page?.schemaState?.viewModel===t):!1}_shouldLoadForPage(e,t){return e?.viewModel===t}_getViews(){const e=[];for(let t=this._viewLoadingOffset;t<=0;t++)e.push(this._routerOutletHistory.getViewByOffset(t));return e}_shouldLoadForViews(){const e=(0,g.getRootViewModel)(this._viewModel);return this._getViews().some(a=>{const f=this._shouldLoadForPage(a,e),w=this._shouldLoadForModals(a,e);return f||w})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===g.ViewModelStates.Paused&&!this._shouldLoad()}setState(e,t){this._disableDelayingModelsEventFeatureState||e._setStateAttribute(t)}destroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete(),this._viewModel=null}ngOnDestroy(){this.destroy()}}S.\u0275fac=function(e){return new(e||S)(l.\u0275\u0275inject(G.CrtRouter,8),l.\u0275\u0275inject(c.B,8),l.\u0275\u0275inject(y.FEATURE_VALUES),l.\u0275\u0275inject(V.WINDOW_TOKEN))},S.\u0275prov=l.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac});class R extends p.BaseCachedHttpService{constructor(){super(...arguments),this.serviceEndpoint="/ServiceModel/ClientUnitSchemaDesignerService.svc"}getParentSchemasLocalizableStrings(e){return this.executePostRequestWithCache("GetParentSchemasLocalizableStrings",{schemaUId:e})}}R.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(R)))(t||R)}}(),R.\u0275prov=l.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac});var A=r(96923);class P extends A.DataSourceStructureExplorerService{constructor(e,t,a,f){super(),this._dataSourceRepository=e,this._dataSchemaRepository=t,this._entityBackwardReferenceService=a,this._featureValues=f}getDataSchemaAttributeByPath(e){return(0,m.throwError)(new Error("Method not implemented"))}getDataSchemaByName(e){return this._dataSchemaRepository.get(e)}getDataSourceByName(e){return(0,m.of)(this._dataSourceRepository.get(e))}getDataSources(){return(0,m.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(e){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(e):(0,m.of)([])}}P.\u0275fac=function(e){return new(e||P)(l.\u0275\u0275inject(h),l.\u0275\u0275inject(g.DataSchemaRepositoryService),l.\u0275\u0275inject(A.EntityBackwardReferenceService),l.\u0275\u0275inject(y.FEATURE_VALUES))},P.\u0275prov=l.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})},39630:(B,N,r)=>{r.d(N,{a:()=>E});var v=r(41307),l=r.n(v),O=r(52045),L=r.n(O),y=r(32935),M=r(94450),m=r.n(M);class E extends O.ProfileSchemaProvider{constructor(d,p){super(d),this._data=p}getProfileKey(d){return super.getProfileKey(d)+"__"+this._data.entitySchemaName}}E.\u0275fac=function(d){return new(d||E)(M.\u0275\u0275inject(v.UserSchemaProfileService),M.\u0275\u0275inject(y.HO))},E.\u0275prov=M.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})},76596:(B,N,r)=>{r.d(N,{F:()=>C,L:()=>s});var v=r(8239),l=r(94450),O=r.n(l),L=r(34038),y=r.n(L),M=r(49475),m=r.n(M),E=r(24709),j=r.n(E),d=r(21322),p=r.n(d),I=r(27049),D=r.n(I);const C=new l.InjectionToken("SCHEMA_MODAL_COMPONENT_TYPE");class s{constructor(i,n,u){this._modalProviderService=i,this._appearanceSettingsService=n,this._schemaModalComponentType=u,this._createdModalsMap=new Map,this._modalCreated=new d.Subject,this._modalClosed=new d.Subject,this.modalCreated$=this._modalCreated.asObservable(),this.modalClosed$=this._modalClosed.asObservable()}_getDialogConfig(i){var n=this;return(0,v.Z)(function*(){const u=yield n._appearanceSettingsService.getSchemaModalClasses(i);return{panelClass:["modal-container",...u],maxWidth:0,maxHeight:"90vh",closeOnNavigation:!1}})()}_onModalClose(i){const h=this._createdModalsMap.get(i).componentInstance.schemaOutletComponent.instance.componentRef.instance.schemaState?.viewModel;this._createdModalsMap.delete(i),this._modalClosed.next(i),(0,d.concat)(h?.pause()??(0,d.of)(null),h?.destroy()??(0,d.of)(null)).pipe((0,I.take)(2)).subscribe()}_onModalCreate(i){this._createdModalsMap.set(i.id,i),this._modalCreated.next(i),i.beforeClosed().pipe((0,I.take)(1)).subscribe(()=>this._onModalClose(i.id))}hideModals(i){const n=this._createdModalsMap;for(const u of i){const h=n.get(u);h&&(this._modalProviderService.hideModal(h),h.componentInstance.schemaOutletComponent.instance.componentRef.instance.onDetach(),h.componentInstance.detachContent())}}closeModals(){const i=this._createdModalsMap;for(const n of Array.from(i.keys())){const u=i.get(n);u&&u.close()}}restoreModals(i){const n=this._createdModalsMap;for(const u of i){const h=n.get(u);if(h){this._modalProviderService.restoreModal(h);const g=h.componentInstance.schemaOutletComponent.instance;h.componentInstance.attachContent(),g.componentRef.instance.onAttach()}}}show(i,n){var u=this;return(0,v.Z)(function*(){const h=yield u._getDialogConfig(i.schemaName);h.injector=n?.injector;const g=u._modalProviderService.open(u._schemaModalComponentType,{data:i,...h});return g.keydownEvents().pipe((0,I.filter)(()=>g.componentInstance.visible),(0,I.switchMap)(F=>{const T=g.componentInstance.page.schemaState.viewModel,G=new E.HandleKeyboardHotkeysRequest(F,T);return T.executeRequest(G)})).subscribe(),g.disableClose=!0,u._onModalCreate(g),g})()}}s.\u0275fac=function(i){return new(i||s)(l.\u0275\u0275inject(L.ModalProvider),l.\u0275\u0275inject(M.AppearanceSettingsService),l.\u0275\u0275inject(C))},s.\u0275prov=l.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}]);
