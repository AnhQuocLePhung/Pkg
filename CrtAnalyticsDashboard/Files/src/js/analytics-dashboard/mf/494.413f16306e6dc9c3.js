(self.webpackChunkapp_studio_enterprise_analytics_dashboard=self.webpackChunkapp_studio_enterprise_analytics_dashboard||[]).push([[494],{50155:(T,x,i)=>{i.r(x),i.d(x,{ExpressionEngine:()=>E.W,ExpressionEngineModule:()=>c.h,ExpressionMetadataAdapter:()=>E.h});var c=i(20255),E=i(8236),n=i(60944),o=i.n(n),d={};for(const u in n)["default","ExpressionEngineModule","ExpressionEngine","ExpressionMetadataAdapter"].indexOf(u)<0&&(d[u]=()=>n[u]);i.d(x,d)},20255:(T,x,i)=>{i.d(x,{h:()=>s});var c=i(74742),E=i(31134),n=i(75378),o=i(60944);let d=class{convert(r,l){const m={type:"crt.ExecuteExpressionRequest",$context:l,metadata:r};return n.HandlerChainService.instance.process(m).then(y=>y?.result).catch(y=>(console.warn(y),null))}};d=(0,c.__decorate)([(0,n.CrtConverter)({type:"crt.ExecuteExpression"})],d);let u=class{convert(r,l){const m={type:"crt.ExecuteExpressionRequest",$context:l,metadata:r};return n.HandlerChainService.instance.process(m).then(y=>y).catch(y=>({success:!1,result:null,errorInfo:y}))}};u=(0,c.__decorate)([(0,n.CrtConverter)({type:"crt.ToExpressionResult"})],u);var p=i(8236);let _=class extends n.BaseRequest{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};_=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.ExecuteExpressionRequest"})],_);let e=class extends n.BaseRequestHandler{constructor(r){super(),this._engine=r}handle(r){return this._engine.execute(r.metadata)}};e=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,c.__metadata)("design:paramtypes",[p.W])],e);var a=i(94450);let s=class{};s.\u0275fac=function(r){return new(r||s)},s.\u0275mod=a.\u0275\u0275defineNgModule({type:s}),s.\u0275inj=a.\u0275\u0275defineInjector({providers:[p.W,p.h],imports:[E.CommonModule,o.ExpressionSchemaModule,o.ExpressionSchemaModule]}),s=(0,c.__decorate)([(0,n.CrtModule)({converters:[d,u],requestHandlers:[e]})],s),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.\u0275\u0275setNgModuleScope(s,{imports:[E.CommonModule,o.ExpressionSchemaModule],exports:[o.ExpressionSchemaModule]})}()},8236:(T,x,i)=>{i.d(x,{W:()=>p,h:()=>u});var c=i(8239),E=i(2876),n=i(75378),o=i(21322),d=i(94450);class u{_getDataValueTypeName(e){switch(e){case n.DataValueType.FLOAT1:return"Float1";case n.DataValueType.FLOAT2:return"Float2";case n.DataValueType.FLOAT3:return"Float3";case n.DataValueType.FLOAT4:return"Float4";case n.DataValueType.FLOAT8:return"Float8";case n.DataValueType.CUSTOM_OBJECT:return"Object";case n.DataValueType.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return n.DataValueType[e]}}_getRequestParameterValueDto(e){const a=e.value;if(Array.isArray(a)){const s=a[0];return Array.isArray(s)?a.map(t=>t.map(r=>({...r,value:this._encodeValue(r.value,r.dataValueType),dataValueType:this._getDataValueTypeName(r.dataValueType)}))):a.map(t=>({...t,value:this._encodeValue(t.value,t.dataValueType),dataValueType:this._getDataValueTypeName(t.dataValueType)}))}return this._encodeValue(a,e.dataValueType)}_encodeValue(e,a){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(a)?(0,n.toLocalISOString)(e):e}decodeValue(e,a){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(a)?new Date(e):e}getExecutionMetadata(e){const a=e.parameters.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType),value:this._getRequestParameterValueDto(t)})),s=e.expressionVariables.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType)}));return JSON.stringify({...e,parameters:a,expressionVariables:s,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}}u.\u0275fac=function(e){return new(e||u)},u.\u0275prov=d.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac,providedIn:"root"});class p{constructor(e,a,s,t){this._httpClient=e,this._featureService=a,this._sysSettingsService=s,this._expressionMetadataAdapter=t,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new o.Subject}_executeImmediate(e){const a={metadata:e};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,a,{headers:new E.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,c.Z)(function*(){const a=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),s=a.values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,t=a.values[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:s,bundleCount:t}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,c.Z)(function*(){const{executionDebounceTime:a,bundleCount:s}=yield e._getBundleSettings();if(e._responses)return;const t=new o.BehaviorSubject(0),r=(0,o.merge)(t.pipe((0,o.filter)(l=>l>=s)),e._requests.pipe((0,o.tap)(()=>{t.next(t.value+1)}),(0,o.debounceTime)(a)));e._responses=e._requests.pipe((0,o.buffer)(r),(0,o.filter)(l=>!!l.length),(0,o.mergeMap)(l=>(t.next(0),e._httpClient.post(e._expressionsEngineEndpoint,l,{headers:new E.HttpHeaders({"Content-Type":"application/json"})}))),(0,o.share)())})()}_executeThrottled(e){var a=this;return(0,c.Z)(function*(){yield a._prepareDebouncedResponsesStream();const s=(0,n.generateGuid)(),t=(0,o.firstValueFrom)(a._responses.pipe((0,o.filter)(r=>r.some(l=>l.executionId===s)),(0,o.map)(r=>r.find(l=>l.executionId===s).result)));return a._requests.next({executionId:s,metadata:e}),t})()}safeExecute(e,a={immediate:!1}){var s=this;return(0,c.Z)(function*(){try{return yield s.execute(e,a)}catch(t){return{success:!1,errorInfo:t,result:null}}})()}execute(e,a={immediate:!1}){var s=this;return(0,c.Z)(function*(){let t;const r=s._expressionMetadataAdapter.getExecutionMetadata(e),l=yield s._featureService.getFeatureState("ExpressionEngineDisableBundling");if(a.immediate||l?t=yield s._executeImmediate(r):t=yield s._executeThrottled(r),!t.success){const m=t.errorInfo;return Promise.reject(`${m.message}`)}return{...t,result:s._expressionMetadataAdapter.decodeValue(t.result,e.resultDataValueType)}})()}}p.\u0275fac=function(e){return new(e||p)(d.\u0275\u0275inject(E.HttpClient),d.\u0275\u0275inject(n.FeatureService),d.\u0275\u0275inject(n.SysSettingsService),d.\u0275\u0275inject(u))},p.\u0275prov=d.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"})}}]);
